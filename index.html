<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="Content/bootstrap.min.css">
    <link rel="stylesheet" href="Content/style.css">
    <title>Diagram as a Service</title>
</head>
<body>
    <div class="container">
        



        <h1>Welcome to DaaS</h1>

        <ul class="nav nav-tabs nav-fill mb-3" role="tablist">
            <li class="active"><a data-toggle="tab" class="btn btn-primary" href="#home">Interactive</a></li>
            <li><a data-toggle="tab" href="#menu1" class="btn btn-secondary">Load from Saved</a></li>
        </ul>

        <div class="tab-content">
            <div id="home" class="tab-pane fade in active">
                <h3>Interactive</h3>
                <p>
                    <div class="accordion" id="accordionExample">
                        <div class="card">
                            <div class="card-header" id="headingOne">
                                <h2 class="mb-0">
                                    <button class="btn btn-link" type="button" data-toggle="collapse" data-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                                        Step 1:Upload your data (json format)
                                    </button>
                                </h2>
                            </div>

                            <div id="collapseOne" class="collapse show" aria-labelledby="headingOne" data-parent="#accordionExample">
                                <div class="card-body">
                                    <input type="file" id="selectFiles" value="Import" />
                                </div>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header" id="headingThree">
                                <h2 class="mb-0">
                                    <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
                                        Step 2: Preview your data
                                    </button>
                                </h2>
                            </div>
                            <div id="collapseThree" class="collapse" aria-labelledby="headingThree" data-parent="#accordionExample">
                                <div class="card-body">
                                    <button id="import" class="btn btn-outline-dark">Show my data</button><br /><br />
                                    <textarea id="result" class="form-control" rows="10" style="height:100%;width:100%"></textarea><br />
                                </div>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header" id="headingTwo">
                                <h2 class="mb-0">
                                    <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                                        Step 3:Give your diagram a title
                                    </button>
                                </h2>
                            </div>
                            <div id="collapseTwo" class="collapse" aria-labelledby="headingTwo" data-parent="#accordionExample">
                                <div class="card-body">
                                    <input type="text" id="customChartTitle" class="form-control" placeholder="Enter Chart Title Here" /><br />
                                </div>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header" id="headingThree">
                                <h2 class="mb-0">
                                    <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseFour" aria-expanded="false" aria-controls="collapseFour">
                                        Step 4:Try it out!
                                    </button>
                                </h2>
                            </div>
                            <div id="collapseFour" class="collapse" aria-labelledby="headingFour" data-parent="#accordionExample">
                                <div class="card-body">
                                    <button class="btn btn-outline-dark" id="loadMore2" disabled>Show</button>
                                </div>
                            </div>
                        </div>
                    </div>

                </p>
            </div>
            <div id="menu1" class="tab-pane fade">
                <h3>Load from Saved</h3>
                <p>
                    <select name="cmbDiagram" id="cmbDiagram">
                        <option value="">Select Diagram</option>
                        <option value="data_images.json">Network Graph showing the IT Landscape - Mobile App Flow</option>
                        <option value="data_images2.json">Test Diagram 2</option>
                    </select>
                    <button id="loadMore" disabled class="btn btn-outline-dark">Load Saved Diagram</button>
                </p>
            </div>
        </div>

    </div>
    <div></div>
    <hr />
    <div id="graphplaceholder"></div>
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="Scripts/jquery-3.5.1.slim.min.js"></script>
    <script src="Scripts/popper.min.js"></script>
    <script src="Scripts/bootstrap.min.js"></script>
    <script src="Scripts/anychart-core.min.js"></script>
    <script src="Scripts/anychart-graph.min.js"></script>
    <script src="Scripts/anychart-data-adapter.min.js"></script>
    <script>




        document.getElementById('import').onclick = function () {
            document.getElementById("graphplaceholder").innerHTML = "";
            var files = document.getElementById('selectFiles').files;

            if (files.length <= 0) {
                return false;
            }

            var fr = new FileReader();

            fr.onload = function (e) {
                var result = JSON.parse(e.target.result);
                var formatted = JSON.stringify(result, null, 2);
                document.getElementById('result').value = formatted;
            }
            fr.readAsText(files.item(0));
            document.getElementById("loadMore2").disabled = false;
        };



        document.getElementById("loadMore2").onclick = function () {
            document.getElementById("graphplaceholder").innerHTML = "";
            var chartTitle = document.getElementById("customChartTitle").value;
            var formatted = document.getElementById('result').value;
            var obj = JSON.parse(formatted);
            drawChart(chartTitle, obj);
        };


        document.getElementById('cmbDiagram').onchange = function () {
            var selVal = document.getElementById('cmbDiagram').value;
            if (selVal == "") {
                document.getElementById("loadMore").disabled = true;
            }
            else {
                document.getElementById("loadMore").disabled = false;
            }

        };


        document.getElementById("loadMore").onclick = function () {
            document.getElementById("graphplaceholder").innerHTML = "";
            var selection = document.getElementById('cmbDiagram');
            var jsonpath = "data/" + selection.value;
            var chartTitle = selection.options[selection.selectedIndex].text;

            anychart.data.loadJsonFile(jsonpath, function (data) {
                //console.log(data);
                drawChart(chartTitle, data);
            });
        };




        function drawChart(chartTitle, JsonData) {
            console.log("You are in with:" + JsonData);
            // create a chart from the loaded data
            var chart = anychart.graph(JsonData);

            //set fixed layout and use xy coordinates for each node
            chart.layout().type('fixed');

            // set the title
            chart.title(chartTitle);

            // access nodes
            var nodes = chart.nodes();
            // set the size of nodes
            nodes.normal().shape("rectangle");
            nodes.normal().height("{%height}");
            nodes.normal().width("{%width}");
            //nodes.hovered().height(45);
            //nodes.selected().height(45);

            //set the size of the edges
            chart.edges().normal().stroke("#cccccc", 2, "10 5", "round");
            chart.edges().hovered().stroke("#663399", 4, "10 5", "rectangle");
            chart.edges().selected().stroke("#663399", 4);

            // set the stroke of nodes
            nodes.normal().stroke(null);
            nodes.hovered().stroke("#333333", 0);
            nodes.selected().stroke("#cccccc", 1);

            // enable the labels of nodes
            chart.nodes().labels().enabled(true);

            // configure the labels of nodes
            chart.nodes().labels().format("{%id}\n{%ipaddress}");
            chart.nodes().labels().fontSize(12);
            chart.nodes().labels().fontWeight(600);

            //enable the labels of the edges
            chart.edges().labels().enabled(true);
            // configure the labels of nodes
            chart.edges().labels().format("{%protocol}-{%port}");
            chart.edges().labels().fontSize(12);
            chart.edges().labels().fontWeight(600);

            //tooltips
            // tooltip padding for all series on a chart
            //chart.tooltip().padding().left(20);

            // background color
            chart.tooltip().background().fill("#663399");
            nodes.tooltip().background().fill("black");


            // draw the chart
            //chart.rotation(180);
            chart.layout().iterationCount(500);
            chart.container("graphplaceholder").draw();
            chart.fit();

        };
    </script>
</body>
</html>